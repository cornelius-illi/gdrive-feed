<% content_for :title, 'List of Changes for resource' %>
<h2><%= @resource.title %> <small>(<%= @resource.mime_type %>)</small></h2>

<% if @resource.jobs.length > 0 %>
    <div class="callout panel">
      <span class="spin1 spinner"></span><i>Indexing in progress! Currently <%= @resource.jobs.length %> jobs are running.
      <%= link_to "Refresh status!" %></i>
    </div>
<% end %>

<ul>
  <li><b>FileID:</b> <%= @resource.gid %></li>
  <li><b>created_date:</b> <%= @resource.created_date %></li>
  <li><b>modified_date:</b> <%= @resource.modified_date %></li>
  <li><b>last_modifying_username:</b> <%= @resource.last_modifying_username %></li>
  <li><b>Number of Revisions:</b> <%= @resource.revisions.length %>
    <% unless @resource.monitored_resource.permission_groups.nil? %>
    <ul>
      <% @resource.revisions_by_permission_group.each do |id, count| %>
          <li><%= id.blank? ? '<i>file-based</i>'.html_safe : PermissionGroup.find(id).name %>: <%= count %></li>
      <% end %>
    </ul>
    <% end %>
  </li>
  <li><b>Number of collaborators:</b> <%= @resource.collaborators.length %>
    <ul>
      <% @resource.collaborators.each do |id,count| %>
        <li><%= Permission.find(id).title %>: <%= count %></li>
      <% end %>
    </ul>
  </li>
</ul>

<% unless @resource.is_folder? %>
  <h3>Changes List - <small><%= link_to 'refresh', refresh_revisions_monitored_resource_resource_path(@monitored_resource, @resource) %></small></h3>
    <% unless @resource.is_folder? || @resource.revisions.length.eql?(0) %>
        <table>
          <thead>
          <tr>
            <th>Revision</th>
            <th>Modification Date</th>
            <th>Last Modifying UserName</th>
            <th>Download</th>
            <th>Changed (in %)</th>
            <th>Additive (in %)</th>
          </tr>
          </thead>
          <tbody>
          <% @resource.revisions.each do |revision| %>
              <tr class="<%= revision.is_weak? ? 'weak' : '' %>">
                <td><%= revision.gid %></td>
                <td><%= revision.modified_date.to_s(:db) %></td>
                <td><%= revision.permission.email_address.blank? ? revision.permission.name : revision.permission.email_address %></td>
                <td class="centered"><%= link_to @resource.export_link('txt', revision.gid), :title => 'Download from Google' do %><span class="fi-download"></span> <% end %> |
                  <% if revision.has_local_resource? %>
                      <%= link_to revision.local_resource_path, :title => 'Download local version' do %><span class="fi-archive"></span><% end %>
                  <% end %>
                </td>
                <td><%= number_to_percentage (revision.percental_change*100) unless revision.percental_change.blank? %></td>
                <td><%= number_to_percentage (revision.percental_add*100) unless revision.percental_add.blank? %></td>
              </tr>
          <% end %>
          </tbody>
        </table>
    <% else %>
        <p><i>No revisions could be found!</i></p>
    <% end %>
<%end %>

<%= link_to 'back', monitored_resource_path(@resource.monitored_resource_id), :class => 'button secondary tiny' %>